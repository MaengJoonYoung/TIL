# **Flask**

<br>

**Flask**는 파이썬으로 웹 어플리케이션을 만들고 배포할 수 있게 해주는 웹 프레임워크다. 웹 프레임워크는 웹 어플리케이션을 만드는 도구 모음이라고 할 수 있는데, Flasks는 **마이크로 웹 프레임워크**이다. 즉, 아주 기초적인 도구들만 모아놓은 것이라고 볼 수 있다. 그렇기에 가볍고 유연하다는 장점이 있다.

<br>
<hr>

<br>

## **1. Flask 어플리케이션 생성**

<br>

그럼 이제 Flask 어플리케이션을 만드는 과정을 살펴보자 우선 flask를 설치하고 어플리케이션을 만들 폴더를 만들어준다. 이때 폴더이름은 보통 어플리케이션의 이름으로 한다. 

어플리케이션을 만들기 위해 `'til_app'` 이라는 폴더를 만들었다고 가정하자. 그리고 그 안에는 `__init__.py` 파일을 만들어 해당 폴더를 패키지로 만들어준다.

*이때 패키지란 우리가 생각하는 라이브러리와도 같은 말인데, 패키지는 폴더에 있는 여러 파일들이 모여서 패키지가 된다.* 

<br>

~~~python
# __init__.py

from flask import Flask

app = Flask(__name__) # 어플의 이름을 폴더 이름으로 만들고 어플을 생성했다.
~~~

<br>

`__init__.py` 안에 `__name__` 으로 어플의 이름을 지정해주면, 어플의 이름은 해당 폴더의 이름이 된다. 우리의 상황을 예로 보자면, 우리의 어플 이름은 `'til_app'` 이 된 것이다. (아마 이러한 이유로 폴더 이름을 어플의 이름으로 하는 것이 아닐까?)

<br>
<br>

#### *(파이썬 예제 등을 찾아 보면 `if __name__ == '__main__':` 을많이 볼 수 있다. 이 if문은 다음과 같이 작동된다. 우선 `print(__name__)` 을 해당 파일에서 실행해보면 `'__main__'` 으로 출력되는 걸 볼 수 있다. 하지만 다른 파일에서 실행하면 해당 파일의 이름이 출력되는 걸 확인할 수 있다. 이러한점을 이용해서 해당 파일에서 실행했을 때에만 if문 아래의 코드들이 실행시키기 위해 `if __name__ == '__main__':`을 사용한다.)*

<br>
<hr>
<br>

## **2. 실행 & 라우트**

<br>

위에서 만든 flask 어플을 실행하려면 아래와 같은 명령어가 필요하다.

<br>

~~~zsh
FLASK_APP=til_app flask run # til_app이 들어가는 자리가 어플의 이름 들어갈 자리이다.
~~~

이렇게 실행하면 어플리케이션에 접속할 수 있는 주소를 받을 수 있는데 다음과 같다.

~~~zsh
Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
~~~

`http://127.0.0.1:5000/` 이 주소가 바로 어플리케이션에 접속할 수 있는 주소인데 `:` 전까지가 'localhost' 이고 5000은 '포트' 다. (localhost와 포트 등은 나중에 나올 엔드포인트와 함께 묶어서 설명.)

위에 주소로 접속하면 Not Found를 만날 수 있을 것이다. 우리가 아직 이름만 정해주고 아무것도 넣지 않았기 때문이다. 

<br>

### *라우트 설정* 

<br>

이제 라우트라는 것을 설정한 후 뭐라도 나오게 해보자. 설정하는 방법은 아래와 같다.

~~~python
@app.route('/til')
def index() :
    return 'anything'
~~~

<br>

이제 flask를 실행하면 'anything' 이 나오는 걸 볼 수 있을 것이다. 라우트는 소괄호 안에 있는 엔드포인트에 접속했을 때 아래 함수를 실행시켜준다. 그렇기에 `http://127.0.0.1:5000/til` 로 접속하면 `index` 함수를 실행해서 'anything'을 띄우는 것이다.

<br>

*자 그럼 이제 IP와 포트 그리고 엔드포인트에 대해서 알아보자.*

*우리가 어떤 서버에 요청을 보내기 위해서는 그 컴퓨터의 주소를 알아야 하는데 그 주소가 바로 IP이다.*

*IP를 알아내서 어떤 컴퓨터에 들어온 후에 A라는 프로그램을 작동시키고 싶은데 이를 위해서는 이 프로그램이 작동되는 집 호수를 알아내 그 집에 들어가서 작동시켜야 한다. 이때 그 집 호수가 포트번호다. (우리는 우리 컴퓨터 주소에서 flask 어플을 실행시키기 위해 5000호 집에 들어온 것이다.)*

*이때 집 안에 여러 방들이 또 있을텐데 그 방들 하나하나가 엔드포인트이다. 우리가 어떤 웹에 접속해서 다른 것들을 막 눌러보면 앞의 주소는 안바뀌고 뒤에만 이상하게 막 바뀌는 걸 볼 수 있다. 그게 여러 한 집에 여러 방 즉, 엔드포인트를 돌아다니는 것이다.*

<br>

라우트를 사용해서 내가 사용하고 싶은 HTTP 메소드를 지정해줄 수 있다. 방법은 아래와 같다.

~~~python
@app.route('/', method=['POST', 'GET'])
~~~

<br> 

만약 아무것도 지정하지 않으면, GET, HEAD, OPTION만 사용할 수 있다.

<br>

엔드포인트는 하나의 엔드포인트만 지정할 수 있는게 아니라 세부 엔드포인트도 지정할 수 있다. `ex/user/name`  이런 식으로 방 안에 방 안에 방으로 들어갈 수도 있다. 또한 라우트를 사용하여 변수도 지정할 수 있는데 방식은 아래와 같다.

~~~python
@app.route('/user/<num>')
def index(num):
    return 'I am %i' % int(num) # URL로 들어오는 타입은 기본적으로 문자열이기에 int로 지정.
~~~

<br>

이제 `'user/1'` 에 접속하면, `I am 1` 을 `'user/2'` 에 접속하면 `I am 2` 를 볼 수 있을 것이다.

<br>
<hr>
<br>
<br>

## **3. HTML 렌더링**

<br>

Flask에서 `render_template`를 사용해서 html 파일을 불러올 수 있다. `render_template`은 프로젝트 폴더에 있는 'templates'을 기본 경로로 사용한다. 그렇기에 'templates' 폴더 안에 html 파일을 작성하고 불러오면 html 파일을 불러올 수 있다. 방법은 아래와 같다. ('test.html'파일을 작성했다고 가정)

<br>

~~~python
@html_rendering.route('/)
def html_rendering():
    return render_template('test.html')
~~~

<br>
<hr>
<br>
<br>


## **4. Jinja**
<br>

이렇게 render_template를 통해 html을 렌더링할 수 있지만 상황에 따라 다른 화면을 보여줘야 하는 경우는 계속 수동으로 바꿔줘야 하기에 어려움이 있다. 이때 사용할 수 있는 **웹 템플릿 엔진이 바로 'Jinja'** 이다. 템플릿 엔진은 맞춤형 웹 페이지를 자동으로 생성해준다. 

Jinja를 사용해서 변수를 넣거나 if, for 문 등을 사용할 수 있다. 방법은 아래와 같다.

<br>

~~~html
<!--test.html-->

{% if ~~~ %}
<h1>{{school}}</h1>
{% endif %} <!--if 문 사용-->

{% for name in student %}
<h1>{{name}}</h1> <!--변수를 사용할 때는 {{}} 안에-->
{% endfor %} <!--for 문 사용-->
~~~

<br>

위에 있는 변수나 리스트 등을 render_template를 활용해 Flask에서 Jinja로 넘길 수 있다.

~~~python
@index.route('/)
def index():
    school = 'til'
    names = ['maneg', 'yubin']
    return render_template('test.html', school = anything, student = names )
~~~